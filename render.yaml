services:
  # Backend API
  - type: web
    name: barakmeetings-api
    runtime: docker
    dockerfilePath: ./backend/Dockerfile
    dockerContext: ./backend
    plan: free
    healthCheckPath: /health
    envVars:
      - key: ASPNETCORE_ENVIRONMENT
        value: Production
      # Secrets - set these in Render Dashboard
      - key: ConnectionStrings__DefaultConnection
        sync: false
      - key: Jwt__Secret
        sync: false
      - key: Email__SmtpUser
        sync: false
      - key: Email__SmtpPassword
        sync: false
      # Email config (non-secret)
      - key: Email__SmtpHost
        value: smtp.gmail.com
      - key: Email__SmtpPort
        value: "587"
      - key: Email__FromEmail
        sync: false
      - key: Email__FromName
        value: BarakMeetings
      - key: Email__EnableSsl
        value: "true"
      - key: Email__IsEnabled
        value: "true"
      # CORS - will update after frontend deploys
      - key: Cors__AllowedOrigins__0
        sync: false

# Static Sites are separate from services
staticSites:
  - name: barakmeetings-app
    buildCommand: npm ci && npm run build
    publishPath: ./dist
    rootDir: ./frontend
    plan: free
    envVars:
      - key: VITE_API_URL
        sync: false
    routes:
      - type: rewrite
        source: /*
        destination: /index.html
