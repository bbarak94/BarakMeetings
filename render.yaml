services:
  # Backend API
  - type: web
    name: booking-api
    runtime: docker
    dockerfilePath: ./backend/Dockerfile
    dockerContext: ./backend
    envVars:
      - key: ASPNETCORE_ENVIRONMENT
        value: Production
      - key: ConnectionStrings__DefaultConnection
        value: Host=ep-divine-flower-ah9vb8is-pooler.c-3.us-east-1.aws.neon.tech;Database=neondb;Username=neondb_owner;Password=npg_1m0FGLYPqRle;SSL Mode=Require
      - key: Jwt__Secret
        value: CHANGE_THIS_TO_A_SECURE_SECRET_KEY_IN_PRODUCTION_MIN_32_CHARS
      - key: Jwt__Issuer
        value: BookingPlatform
      - key: Jwt__Audience
        value: BookingPlatformClients
      - key: Jwt__ExpirationMinutes
        value: "60"
    healthCheckPath: /api/health

  # Frontend
  - type: web
    name: booking-frontend
    runtime: static
    buildCommand: npm ci && npm run build
    staticPublishPath: ./dist
    rootDir: ./frontend
    envVars:
      - key: VITE_API_URL
        value: https://booking-api.onrender.com/api
    routes:
      - type: rewrite
        source: /*
        destination: /index.html
